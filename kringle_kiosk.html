<html>
<head>
    <link rel="stylesheet" href="./css/style.css">
    <title>Castle Approach: SANS Holiday Hack 2020</title>
    <script type="text/javascript" src="./scripts/chars.js"></script>
</head>
<body>
<div class="content-surround main-centered">
    <div class="content-background">
        <div id="mainContent" class="content-body">
            <div class="content">
                <!--
                Common - v2020.DEC.23
                -->




                <div class="title">Kringle Kiosk: SHHC20</div>
                <div class="subtitle">A Place to Start...</div>
                <div class="writeup">
                    <div class="polaroid-rotate">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_castle_approach_shinny_upatree')">
                                <div class="polaroid-caption">Kringle Kiosk</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_castle_approach_shinny_upatree" class="polaroid-img" style="background-image: url('./screenshots/castle_approach_shinny_upatree.jpg');">&nbsp;</div></div>
                        </div>
                    </div>

                    <p>The Kringle Kiosk was beside my friend <span class="char" onclick="OpenCharModal('shinny_upatree')">Shinny Upatree</span> in the <a href="./castle_approach.html" class="place">Castle Approach</a>.  In describing the
                        kiosk, Shinny made me aware of some issues when printing out a badge.  Hmmm...</p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate-right">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_1')">
                                <div class="polaroid-caption">Kiosk Welcome</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_1" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_1.jpg');">&nbsp;</div></div>
                        </div>
                    </div>

                    <p>Upon launching the terminal, I was presented with a challenge to launch /bin/bash.  Challenge accepted!</p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_2')">
                                <div class="polaroid-caption">Map of Castle</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_2" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_2.jpg');">&nbsp;</div></div>
                        </div>
                    </div>
                    <p>Looking thru the menu items I see a map of the castle...</p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate-right">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_3')">
                                <div class="polaroid-caption">Code of Conduct/ToS</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_3" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_3.jpg');">&nbsp;</div></div>
                        </div>
                    </div>
                    <p>A code of conduct and ToS (very important in this day)...</p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_4')">
                                <div class="polaroid-caption">Directory</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_4" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_4.jpg');">&nbsp;</div></div>
                        </div>
                    </div>

                    <p>A directory of folks I can expect to meet.  I'm happy to see some familiar names here!  (gotta keep this list in mind)</p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate-right">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_5')">
                                <div class="polaroid-caption">Print Badge</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_5" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_5.jpg');">&nbsp;</div></div>
                        </div>
                    </div>

                    <p>And finally the ability to print a badge...  Printing a badge with my name doesn't make anything bad happen, but the
                        comments mention to not use special characters (that makes me think it's not doing escaping appropriately).  The main menu also makes mention of any input other
                        than 1-5 having unintended consequences.  Time to start doing what we're not supposed to do!  :-)</p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_6')">
                                <div class="polaroid-caption">Invalid Input</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_6" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_6.jpg');">&nbsp;</div></div>
                        </div>
                    </div>

                    <p>First I tried some basic invalid data entry by entering numbers or letters in the main menu, which just responded with Error.  Nothing interesting initially, so I went to the badge print to play around some...</p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate-right">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_7')">
                                <div class="polaroid-caption">Command Subsitution</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_7" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_7.jpg');">&nbsp;</div></div>
                        </div>
                    </div>
                    <p>When I went to the print badge screen and tried to embed a command by printing <span class="cmd cmd-sur">glutious `/bin/bash` foobar</span> I was promptly (rimshot) dropped to a shell.  Zonks!
                    A quick recon (ls, pwd, whoami) didn't show stdout being returned directly (which made sense, since it is command substitution), but when it executed exit, I was greated with my badge, but with all that stdoutcontent embedded.</p>
                    <p>However, the automagic system didn't seem to recognize the hash codes, so I closed out the window and relaunched.  This time I tried printing just with <span class="cmd cmd-sur">`/bin/bash`</span>, but still no recognition.  Hmmm...
                        So I tried executing with <span class="cmd cmd-sur">`/bin/bash -c whoami'</span>, which responded 'shinny'.  Interesting!  <span class="cmd cmd-sur">`/bin/bash -c pwd`</span> showed '/home/shinny'.

                    </p>
                </div>
                <div class="writeup">
                    <div class="polaroid-rotate">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_8')">
                                <div class="polaroid-caption">welcome.sh</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_8" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_8.jpg');">&nbsp;</div></div>
                        </div>
                    </div>
                    <p>Next I tried <span class="cmd cmd-sur">`/bin/bash -c ls -las`</span>, which shows the only file in the directory is welcome.sh.  Lets see if we can see the contents of that file.  <span class="cmd cmd-sur">`/bin/bash -c cat ./welcome.sh`</span>.
                        This showed no response...  Foo...  Lets try something else...  Executing <span class="cmd cmd-sur">foo $(cat welcome.sh) bar</span> got me what I was looking for.

                    </p>
                </div>
                <div class="subtitle">Done, but not Finished...</div>
                    <p>At this point, I was invoked a bash shell, but I could read the input until it was embedded within the badge.  I was in, but not in the way the auto-scoring system (and experts) would expect.  So how the heck can I
                        invoke a shell in a command substitution and get stdout to the terminal?  Googling didn't provide me an answer (somedays, the wordsmithing muse of G is fickle).  </p>
                <p>Looking at the contents of <span class="question cmd-sur">/opt/reindeer.cow</span> show some ascii for the reindeer...</p>
                <p>Looking at the content of <span class="question cmd-sur">/usr/games/cowsay</span> shows this to be a perl script called Cowsay...</p>
                <p>Reviewing the contents of the directory again, I see a <span class="question cmd-sur">.bashrc</span>, so lets see whats in that.  Hmmm, mentions a <span class="question cmd-sur">/opt/success.txt</span>.  Let's look at that.  It's part of the content that is only getting displayed on exit.</p>

                <p>So I thought about redirecting stdout to stderr to
                    see if I could "see" that since failed commands were being returned.  I executed the initial commands from .bashrc - <span class="cmd cmd-sur">$(/home/elf/runtoanswer WelcomeToSantasCastle 1>&2)</span>.  Boom!  The auto-score system reported I'd achieved the challenge.  But...  I still didn't see anything in the terminal...
                    </p>
                    <p>This is one of those circumstances where I did it, but there's gotta be a much better way of going about doing it...  I accepted by status for the time being, and decided to move on for now.  But I do want to revisit
                    this to learn other techniques on how I could have approached this challenge.</p>


                <div class="subtitle">Something Extra...</div>

                <div class="writeup">
                    <div class="polaroid-rotate-right">
                        <div class="polaroid-surround">
                            <div class="polaroid-frame" onclick="OpenImgModal('img_kringle_kiosk_extra_1')">
                                <div class="polaroid-caption">A Plant</div>
                            </div>
                            <div class="polaroid-img-bg"><div id="img_kringle_kiosk_extra_1" class="polaroid-img" style="background-image: url('./evidence/kringle_kiosk_extra_1.jpg');">&nbsp;</div></div>
                        </div>
                    </div>
                    <p>Looking through the menu script, I did notice that there was a 'surprise' function that cat <span class="question cmd-sur">/opt/plant.txt</span>, so I tried directly displaying the file using <span class="cmd cmd-sur">$(cat /opt/plant.txt)</span> and it shows
                        something slightly interesting, but the ascii art is getting mangled because command substition is removing all the newlines.  Looking back at the script, I see that the command is 'plant', so I ran that...
                        </p>
                </div>


                <div class="writeup">
                    <p>More shenanigans were behad in the <a href="./castle_approach.html" class="link">Castle Approach</a>.</p>
                </div>







                <!--
                Common - v2020.DEC.23
                -->
            </div>
            <div class="footer" style="">
                <span class="footer-text">
                    <a href="./index.html">Find Other Scrolls</a> | <a href="mailto:jeremy@uranusbytes.com">jeremy@uranusbytes.com</a> | <a href="./credits.html">Credits</a>
                </span>
            </div>
        </div>
    </div>
</div>

<div id="ImgModalDiv" class="modal2">
    <span id="ImgModalClose" class="modal-close" onclick="CloseImgModal();">&times;</span>
    <div class="polaroid-big-rotate">
        <div class="polaroid-big-surround">
            <img id="ModalImg" src="./images/blank.png" class="polaroid-big" />
        </div>
    </div>
</div>


<div id="CharModalDiv" class="modal">
    <span id="CharModalClose" class="modal-close" onclick="CloseCharModal();">&times;</span>
    <div class="char-container">
        <div class="char-child" style="flex-grow: 1; overflow: hidden;">
            <div id="CharName" class="char-name">Jingle</div>
            <img id="CharAvatar" class="char-avatar" src="./images/blank.png">
        </div>
        <div class="char-child" style="flex-grow: 1;">
            <div class="char-name">Dialog</div>
            <div id="CharDialog" class="char-dialog"></div>
        </div>
    </div>
</div>

</body>
</html>

